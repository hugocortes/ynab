generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  extensions        = [vector(version: "0.7.0"), pg_trgm(version: "1.4")]
  provider          = "postgresql"
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  url               = env("DATABASE_URL")
}

model MoneyAccount {
  moneyAccountId String                 @id @default(uuid()) @db.Uuid
  externalId     String                 @db.VarChar(255)
  name           String                 @db.VarChar(255)
  type           enum_MoneyAccount_type
  createdAt      DateTime               @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime               @updatedAt @db.Timestamptz(6)

  moneyAccountAggregatedHistory  MoneyAccountAggregatedHistory[]
  moneyAccountCapitalFlowHistory MoneyAccountCapitalFlowHistory[]
}

model MoneyAccountAggregatedHistory {
  moneyAccountAggregatedHistoryId String                                    @id @default(uuid()) @db.Uuid
  moneyAccountId                  String                                    @db.Uuid
  balance                         Float
  date                            DateTime                                  @db.Timestamptz(6)
  period                          enum_MoneyAccountAggregatedHistory_period
  totalCapitalFlow                Float
  totalInflow                     Float
  totalOutflow                    Float
  createdAt                       DateTime                                  @default(now()) @db.Timestamptz(6)
  updatedAt                       DateTime                                  @updatedAt @db.Timestamptz(6)

  moneyAccount MoneyAccount @relation(fields: [moneyAccountId], references: [moneyAccountId], onDelete: Cascade)
}

model MoneyAccountCapitalFlowHistory {
  moneyAccountCapitalFlowHistoryId String                                   @id @default(uuid()) @db.Uuid
  moneyAccountId                   String                                   @db.Uuid
  amount                           Float
  date                             DateTime                                 @db.Timestamptz(6)
  type                             enum_MoneyAccountCapitalFlowHistory_type
  createdAt                        DateTime                                 @default(now()) @db.Timestamptz(6)
  updatedAt                        DateTime                                 @updatedAt @db.Timestamptz(6)

  moneyAccount MoneyAccount @relation(fields: [moneyAccountId], references: [moneyAccountId], onDelete: Cascade)
}

enum enum_MoneyAccount_type {
  cash
  investment
}

enum enum_MoneyAccountAggregatedHistory_period {
  month
}

enum enum_MoneyAccountCapitalFlowHistory_type {
  income
  investmentContribution
  market
  transaction
}
